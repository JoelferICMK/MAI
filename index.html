<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Diabetes Detection AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Diabetes Detection AI</h1>
        
        <div class="progress-container">
            <div class="step active" id="step1">1</div>
            <div class="step-line" id="line1"></div>
            <div class="step" id="step2">2</div>
            <div class="step-line" id="line2"></div>
            <div class="step" id="step3">3</div>
            <div class="step-line" id="line3"></div>
            <div class="step" id="step4">4</div>
        </div>
        
        <div class="greeting" id="greeting">
            <p>Good Day! Welcome to Diabetes Prediction AI.</p>
            <p>This tool was created by students of Silver-Stem of Gen. Juan Castaneda Senior High School. 
                Our AI helps to detect Diabetic person base on their given BMI, Background and Glucose level for at least 7 days.</p>
            <button id="startBtn">Start Test</button>
        </div>
        
        <div class="demographic-section hidden" id="demographicSection">
            <h2>Personal Information</h2>
            <p>Please Input your correct information</p>
            
            <div class="demographic-info">
                <div class="form-group">
                    <label for="ageInput">Age:</label>
                    <input type="number" id="ageInput" min="1" max="120" placeholder="Ex: 45">
                </div>
                
                <div class="form-group">
                    <label for="genderInput">Sex:</label>
                    <select id="genderInput">
                        <option value="">-- Options --</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">-</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="heightInput">Height (cm):</label>
                    <input type="number" id="heightInput" min="30" max="250" placeholder="Ex: 165">
                </div>
                
                <div class="form-group">
                    <label for="weightInput">Weight (kg):</label>
                    <input type="number" id="weightInput" min="20" max="300" placeholder="Ex: 70">
                </div>
            </div>
            
            <div class="risk-factors">
                <div class="risk-factors-title">
                    <h3>Risk Factors</h3>
                    <button id="selectAllBtn" class="secondary">Select All</button>
                </div>
                <p>Add a check that applies to you</p>
                
                <div class="risk-factors-grid">
                    <div class="checkbox-item">
                        <input type="checkbox" id="familyHistory" name="riskFactor" value="familyHistory">
                        <label for="familyHistory">Has a Relative with Diabetes</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="hypertension" name="riskFactor" value="hypertension">
                        <label for="hypertension">With High Blood Pressure</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="physicalInactivity" name="riskFactor" value="physicalInactivity">
                        <label for="physicalInactivity">Does Not Exercise Regularly</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="gestational" name="riskFactor" value="gestational">
                        <label for="gestational">Had a Gestational Diabetes</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="pcos" name="riskFactor" value="pcos">
                        <label for="pcos">Has PCOS (Polycystic Ovary Syndrome)</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="cholesterol" name="riskFactor" value="cholesterol">
                        <label for="cholesterol">Has a High Cholesterol</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="heartDisease" name="riskFactor" value="heartDisease">
                        <label for="heartDisease">Has heart disease</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="prediabetesHistory" name="riskFactor" value="prediabetesHistory">
                        <label for="prediabetesHistory">Diagnosed with Prediabetes before</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="ethnicRisk" name="riskFactor" value="ethnicRisk">
                        <label for="ethnicRisk">Belongs to a high-risk ethnic group <span class="tooltip">â“˜<span class="tooltiptext">Asian, Pacific Islander, African, Hispanic/Latino, at Indigenous/native</span></span></label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="sleep" name="riskFactor" value="sleep">
                        <label for="sleep">Has sleep problems (apnea)</label>
                    </div>
                </div>
                
                <div class="risk-score hidden" id="riskScoreDisplay">
                    Risk Score: <span id="riskScoreValue">0</span>/10
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="demographicNextBtn">Next</button>
            </div>
        </div>
        
        <div class="unit-selector hidden" id="unitSection">
            <h2>Select Unit of Measurement</h2>
            <p>What unit does your glucometer use?</p>
            <button id="mgdlBtn">mg/dL</button>
            <button id="mmolBtn">mmol/L</button>
        </div>
        
        <div class="input-section hidden" id="inputSection">
            <h2>Records of Glucose Readings</h2>
            <p>Please input your blood glucose readings for the past week</p>
            <p>"You may enter any number of reading"</p>
            
            <div class="reading-list" id="readingList">
                <table id="readingsTable">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Time</th>
                            <th>Reading (<span id="unitLabel">mg/dL</span>)</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="readingsTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="reading-row">
                <select id="dayInput">
                    <option value="Lunes">Monday</option>
                    <option value="Martes">Tuesday</option>
                    <option value="Miyerkules">Wednesday</option>
                    <option value="Huwebes">Thursday</option>
                    <option value="Biyernes">Friday</option>
                    <option value="Sabado">Saturday</option>
                    <option value="Linggo">Sunday</option>
                </select>
                <select id="timeInput">
                    <option value="Fasting">Fasting (Upon Waking up)</option>
                    <option value="Before Breakfast">Before Breakfast</option>
                    <option value="After Breakfast">After Breakfast</option>
                    <option value="Before Lunch">Before Lunch</option>
                    <option value="After Lunch">After Lunch</option>
                    <option value="Before Dinner">Before Dinner</option>
                    <option value="After Dinner">After Dinner</option>
                    <option value="Before Bedtime">Before going to bed</option>
                    <option value="Random">Random</option>
                </select>
                <input type="number" id="glucoseInput" min="0" max="1000" placeholder="Glucose Level">
                <button class="add-btn" id="addReadingBtn">+ Add</button>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="analyzeBtn" disabled>Test the Data</button>
            </div>
        </div>
        
        <div class="result hidden" id="resultSection">
            <h2>Result of the Test</h2>
            <div id="resultText"></div>
            <div class="info-section" id="infoSection"></div>
            <div id="riskFactorSummary"></div>
            <div id="chartContainer" style="height: 300px; width: 100%; margin-top: 20px;"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="resetBtn">Home</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Init variables
            const startBtn = document.getElementById('startBtn');
            const mgdlBtn = document.getElementById('mgdlBtn');
            const mmolBtn = document.getElementById('mmolBtn');
            const addReadingBtn = document.getElementById('addReadingBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const resetBtn = document.getElementById('resetBtn');
            const selectAllBtn = document.getElementById('selectAllBtn');
            const demographicNextBtn = document.getElementById('demographicNextBtn');
            
            const greeting = document.getElementById('greeting');
            const demographicSection = document.getElementById('demographicSection');
            const unitSection = document.getElementById('unitSection');
            const inputSection = document.getElementById('inputSection');
            const resultSection = document.getElementById('resultSection');
            const resultText = document.getElementById('resultText');
            const infoSection = document.getElementById('infoSection');
            const riskFactorSummary = document.getElementById('riskFactorSummary');
            const glucoseInput = document.getElementById('glucoseInput');
            const dayInput = document.getElementById('dayInput');
            const timeInput = document.getElementById('timeInput');
            const readingsTableBody = document.getElementById('readingsTableBody');
            const unitLabel = document.getElementById('unitLabel');
            const riskScoreDisplay = document.getElementById('riskScoreDisplay');
            const riskScoreValue = document.getElementById('riskScoreValue');
            
            let selectedUnit = 'mg/dL';
            let readings = [];
            let riskFactors = [];
            let userProfile = {
                age: 0,
                gender: '',
                height: 0,
                weight: 0,
                bmi: 0
            };
            
            // Progress steps
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const step4 = document.getElementById('step4');
            const line1 = document.getElementById('line1');
            const line2 = document.getElementById('line2');
            const line3 = document.getElementById('line3');
            
            startBtn.addEventListener('click', function() {
                greeting.classList.add('hidden');
                demographicSection.classList.remove('hidden');
                step2.classList.add('active');
                line1.classList.add('active');
            });
            
            // Handle risk factor selection
            document.querySelectorAll('input[name="riskFactor"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateRiskScore);
            });
            
            // Select all risk factors button
            selectAllBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="riskFactor"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                checkboxes.forEach(checkbox => {
                    checkbox.checked = !allChecked;
                });
                
                updateRiskScore();
            });
            
            // Update risk score whenever a checkbox is changed
            function updateRiskScore() {
                const checkedFactors = document.querySelectorAll('input[name="riskFactor"]:checked');
                riskFactors = Array.from(checkedFactors).map(cb => cb.value);
                
                // Calculate risk score
                let score = riskFactors.length;
                
                // Adjust score based on number of factors (max 10)
                score = Math.min(score, 10);
                
                riskScoreValue.textContent = score;
                riskScoreDisplay.classList.remove('hidden');
            }
            
            demographicNextBtn.addEventListener('click', function() {
                // Collect demographic info
                const age = parseInt(document.getElementById('ageInput').value);
                const gender = document.getElementById('genderInput').value;
                const height = parseFloat(document.getElementById('heightInput').value);
                const weight = parseFloat(document.getElementById('weightInput').value);
                
                // Validate required fields
                if (isNaN(age) || age <= 0 || age > 120) {
                    alert('Pakiusap maglagay ng tamang edad (1-120).');
                    return;
                }
                
                if (gender === '') {
                    alert('Pakiusap pumili ng kasarian.');
                    return;
                }
                
                // BMI calculation if height and weight are provided
                let bmi = 0;
                if (!isNaN(height) && !isNaN(weight) && height > 0 && weight > 0) {
                    bmi = weight / ((height/100) * (height/100));
                }
                
                // Save user profile
                userProfile = {
                    age: age,
                    gender: gender,
                    height: height || 0,
                    weight: weight || 0,
                    bmi: bmi
                };
                
                // If BMI is high, automatically add it as a risk factor
                if (bmi >= 25) {
                    if (!riskFactors.includes('obesity')) {
                        riskFactors.push('obesity');
                    }
                }
                
                // Move to next section
                demographicSection.classList.add('hidden');
                unitSection.classList.remove('hidden');
                step3.classList.add('active');
                line2.classList.add('active');
            });
            
            mgdlBtn.addEventListener('click', function() {
                selectedUnit = 'mg/dL';
                unitLabel.textContent = 'mg/dL';
                unitSection.classList.add('hidden');
                inputSection.classList.remove('hidden');
                step4.classList.add('active');
                line3.classList.add('active');
            });
            
            mmolBtn.addEventListener('click', function() {
                selectedUnit = 'mmol/L';
                unitLabel.textContent = 'mmol/L';
                unitSection.classList.add('hidden');
                inputSection.classList.remove('hidden');
                step4.classList.add('active');
                line3.classList.add('active');
            });
            
            addReadingBtn.addEventListener('click', function() {
                const glucoseLevel = parseFloat(glucoseInput.value);
                const day = dayInput.value;
                const time = timeInput.value;
                
                if (isNaN(glucoseLevel) || glucoseLevel <= 0) {
                    alert('Please Input Correct GLucose Level');
                    return;
                }
                
                // Add reading to array
                readings.push({
                    day: day,
                    time: time,
                    level: glucoseLevel,
                    unit: selectedUnit
                });
                
                // Display in table
                updateReadingsTable();
                
                // Clear input fields
                glucoseInput.value = '';
                
                // Enable analyze button if we have at least one reading
                if (readings.length > 0) {
                    analyzeBtn.disabled = false;
                }
            });
            
            analyzeBtn.addEventListener('click', function() {
                const result = analyzeGlucoseLevels(readings, userProfile, riskFactors);
                
                resultText.innerHTML = result.message;
                resultSection.className = `result ${result.class}`;
                infoSection.innerHTML = result.info;
                
                // Display risk factor summary
                if (riskFactors.length > 0) {
                    let riskFactorHTML = '<h3>Your Risk Factors:</h3><ul>';
                    
                    // Map risk factor values to readable text
                    const riskFactorLabels = {
                        familyHistory: '"Has a relative with diabetes."',
                        hypertension: 'Have a High Blood Pressure',
                        physicalInactivity: 'Irregular Exercise',
                        gestational: 'Had a Gestational Diabetes',
                        pcos: 'Has PCOS (Polycystic Ovary Syndrome)',
                        cholesterol: 'Has a High cholesterol',
                        heartDisease: 'Has heart disease',
                        prediabetesHistory: 'Diagnosed with Prediabetes',
                        ethnicRisk: 'Belongs to High-risk ethnic group',
                        sleep: 'Has sleep problem (apnea)',
                        obesity: 'BMI >= 25 (overwight o obese)'
                    };
                    
                    riskFactors.forEach(factor => {
                        riskFactorHTML += `<li>${riskFactorLabels[factor] || factor}</li>`;
                    });
                    
                    riskFactorHTML += '</ul>';
                    riskFactorSummary.innerHTML = riskFactorHTML;
                } else {
                    riskFactorSummary.innerHTML = '';
                }
                
                inputSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
            });
            
            resetBtn.addEventListener('click', function() {
                // Reset all data
                readings = [];
                riskFactors = [];
                userProfile = {
                    age: 0,
                    gender: '',
                    height: 0,
                    weight: 0,
                    bmi: 0
                };
                
                // Clear form fields
                document.getElementById('ageInput').value = '';
                document.getElementById('genderInput').value = '';
                document.getElementById('heightInput').value = '';
                document.getElementById('weightInput').value = '';
                document.querySelectorAll('input[name="riskFactor"]').forEach(cb => cb.checked = false);
                glucoseInput.value = '';
                
                // Reset UI
                updateReadingsTable();
                analyzeBtn.disabled = true;
                riskScoreDisplay.classList.add('hidden');
                
                // Reset progress and display first screen
                resultSection.classList.add('hidden');
                greeting.classList.remove('hidden');
                
                // Reset progress steps
                step2.classList.remove('active');
                step3.classList.remove('active');
                step4.classList.remove('active');
                line1.classList.remove('active');
                line2.classList.remove('active');
                line3.classList.remove('active');
            });
            
            function updateReadingsTable() {
                // Clear table first
                readingsTableBody.innerHTML = '';
                
                // Add all readings to the table
                readings.forEach((reading, index) => {
                    const row = document.createElement('tr');
                    
                    const dayCell = document.createElement('td');
                    dayCell.textContent = reading.day;
                    row.appendChild(dayCell);
                    
                    const timeCell = document.createElement('td');
                    timeCell.textContent = reading.time;
                    row.appendChild(timeCell);
                    
                    const levelCell = document.createElement('td');
                    levelCell.textContent = reading.level + ' ' + reading.unit;
                    row.appendChild(levelCell);
                    
                    const statusCell = document.createElement('td');
                    statusCell.textContent = getStatusForReading(reading);
                    row.appendChild(statusCell);
                    
                    const actionCell = document.createElement('td');
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Alisin';
                    removeBtn.className = 'remove-btn';
                    removeBtn.onclick = function() {
                        readings.splice(index, 1);
                        updateReadingsTable();
                        if (readings.length === 0) {
                            analyzeBtn.disabled = true;
                        }
                    };
                    actionCell.appendChild(removeBtn);
                    row.appendChild(actionCell);
                    
                    readingsTableBody.appendChild(row);
                });
            }
            
            function getStatusForReading(reading) {
                let level = reading.level;
                
                // Convert mmol/L to mg/dL for consistent evaluation
                if (reading.unit === 'mmol/L') {
                    level = level * 18;  // convert to mg/dL
                }
                
                if (reading.time === 'Fasting' || reading.time === 'Before Breakfast') {
                    if (level < 100) return 'Normal';
                    if (level >= 100 && level <= 125) return 'Prediabetes';
                    return 'Mataas';
                } else {
                    if (level < 140) return 'Normal';
                    if (level >= 140 && level <= 199) return 'Prediabetes';
                    return 'Mataas';
                }
            }
            
            function analyzeGlucoseLevels(readings, userProfile, riskFactors) {
                let result = {
                    message: '',
                    class: '',
                    info: ''
                };
                
                // Convert all readings to mg/dL for consistent analysis
                const standardizedReadings = readings.map(reading => {
                    let level = reading.level;
                    if (reading.unit === 'mmol/L') {
                        level = level * 18;  // Convert mmol/L to mg/dL
                    }
                    return {
                        ...reading,
                        standardizedLevel: level
                    };
                });
                
                // Count abnormal readings
                const fastingReadings = standardizedReadings.filter(r => 
                    r.time === 'Fasting' || r.time === 'Before Breakfast');
                
                const otherReadings = standardizedReadings.filter(r => 
                    r.time !== 'Fasting' && r.time !== 'Before Breakfast');
                
                const highFastingCount = fastingReadings.filter(r => r.standardizedLevel >= 126).length;
                const highRandomCount = otherReadings.filter(r => r.standardizedLevel >= 200).length;
                const prediabetesFastingCount = fastingReadings.filter(r => 
                    r.standardizedLevel >= 100 && r.standardizedLevel <= 125).length;
                const prediabetesRandomCount = otherReadings.filter(r => 
                    r.standardizedLevel >= 140 && r.standardizedLevel <= 199).length;
                
                // Calculate average levels
                const averageFasting = fastingReadings.length > 0 ? 
                    fastingReadings.reduce((sum, r) => sum + r.standardizedLevel, 0) / fastingReadings.length : 0;
                
                const averageOverall = standardizedReadings.length > 0 ? 
                    standardizedReadings.reduce((sum, r) => sum + r.standardizedLevel, 0) / standardizedReadings.length : 0;
                
                // Calculate risk score based on demographic info and risk factors
                let diabetesRiskScore = calculateDiabetesRiskScore(userProfile, riskFactors);
                
                // Add demographic summary
                let demographicSummary = '';
                if (userProfile.age > 0) {
                    demographicSummary += `<p><strong>Edad:</strong> ${userProfile.age}</p>`;
                    
                    if (userProfile.height > 0 && userProfile.weight > 0) {
                        demographicSummary += `<p><strong>BMI:</strong> ${userProfile.bmi.toFixed(1)} `;
                        
                        if (userProfile.bmi < 18.5) {
                            demographicSummary += '(Underweight)';
                        } else if (userProfile.bmi < 25) {
                            demographicSummary += '(Normal)';
                        } else if (userProfile.bmi < 30) {
                            demographicSummary += '(Overweight)';
                        } else {
                            demographicSummary += '(Obese)';
                        }
                        
                        demographicSummary += '</p>';
                    }
                }
                
                // Check for patterns indicative of different types of diabetes
                
                // Normal: Most readings normal and low risk score
                if (highFastingCount === 0 && highRandomCount === 0 && 
                    prediabetesFastingCount <= fastingReadings.length * 0.2 && 
                    prediabetesRandomCount <= otherReadings.length * 0.2 &&
                    diabetesRiskScore < 5) {
                    
                    result.message = '<h3>Normal na Glucose Levels</h3>';
                    result.message += '<p>Base sa iyong mga glucose readings at risk factors, ang iyong mga antas ng asukal sa dugo ay nasa normal na saklaw.</p>';
                    result.class = 'normal';
                    result.info = demographicSummary;
                    result.info += '<p>Ang normal na fasting glucose level ay mas mababa sa 100 mg/dL (5.6 mmol/L). ' +
                                 'Ang normal na random glucose level ay mas mababa sa 140 mg/dL (7.8 mmol/L).</p>' +
                                 '<p>Ipagpatuloy ang malusog na pamumuhay, balanced diet, at regular na physical activity ' +
                                 'upang mapanatili ang malusog na antas ng asukal sa dugo.</p>';
                    
                    if (diabetesRiskScore >= 3) {
                        result.info += '<p><strong>Babala:</strong> Kahit normal ang iyong glucose readings, mayroon kang ilang risk factors para sa diabetes. Inirerekomenda na magkaroon ng regular na check-up at pagsusubaybay ng glucose levels.</p>';
                    }
                }
                // Prediabetes: Moderate elevation or higher risk score
                else if (((prediabetesFastingCount > fastingReadings.length * 0.5 || 
                         prediabetesRandomCount > otherReadings.length * 0.5) && 
                         highFastingCount <= fastingReadings.length * 0.2 && 
                         highRandomCount <= otherReadings.length * 0.2) ||
                         (diabetesRiskScore >= 5 && diabetesRiskScore < 8 && 
                          highFastingCount === 0 && highRandomCount === 0)) {
                    
                    result.message = '<h3>Posibleng Prediabetes</h3>';
                    result.message += '<p>Base sa iyong mga glucose readings at risk factors, mayroon kang mga antas ng glucose na tumataas, na posibleng nagpapahiwatig ng prediabetes.</p>';
                    result.class = 'prediabetes';
                    result.info = demographicSummary;
                    result.info += '<p>Ang prediabetes ay isang kondisyon kung saan ang mga antas ng asukal sa dugo ay mas mataas kaysa normal ngunit ' +
                                 'hindi pa sapat na mataas upang ma-diagnose bilang diabetes. Fasting glucose levels na 100-125 mg/dL (5.6-6.9 mmol/L) o ' +
                                 'random glucose levels na 140-199 mg/dL (7.8-11.0 mmol/L) ay karaniwang nagpapahiwatig ng prediabetes.</p>' +
                                 '<p>Ang prediabetes ay maaaring mapigilan mula sa pag-unlad sa Type 2 diabetes sa pamamagitan ng mga pagbabago sa lifestyle tulad ng ' +
                                 'pagbawas ng timbang, regular na exercise, at balanced diet.</p>' +
                                 '<p>Inirerekomenda na kumunsulta sa healthcare professional para sa kumpirmadong diagnosis at personalized na advice.</p>';
                }
                // Type 1 or Type 2 Diabetes patterns
                else if (highFastingCount > 0 || highRandomCount > 0 || diabetesRiskScore >= 8) {
                    // Type 1 vs Type 2 determination
                    // Various factors to consider:
                    
                    let type1Indicators = 0;
                    let type2Indicators = 0;
                    
                    // High variability and very high spikes can suggest Type 1
                    const stdDeviation = calculateStandardDeviation(standardizedReadings.map(r => r.standardizedLevel));
                    const maxReading = Math.max(...standardizedReadings.map(r => r.standardizedLevel));
                    
                    // Age is a strong factor - Type 1 more common in younger people
                    if (userProfile.age < 30) {
                        type1Indicators += 2;
                    } else if (userProfile.age >= 40) {
                        type2Indicators += 2;
                    }
                    
                    // High variability suggests Type 1
                    if (stdDeviation > 60) {
                        type1Indicators += 1;
                    }
                    
                    // Very high readings suggest Type 1
                    if (maxReading > 300) {
                        type1Indicators += 1;
                    }
                    
                    // BMI - Type 2 more common with high BMI
                    if (userProfile.bmi >= 30) {
                        type2Indicators += 2;
                    } else if (userProfile.bmi <= 25 && userProfile.bmi > 0) {
                        type1Indicators += 1;
                    }
                    
                    // Family history and other risk factors for Type 2
                    if (riskFactors.includes('familyHistory')) {
                        type2Indicators += 1;
                    }
                    
                    if (riskFactors.includes('hypertension') || 
                        riskFactors.includes('cholesterol') || 
                        riskFactors.includes('heartDisease')) {
                        type2Indicators += 1;
                    }
                    
                    if (riskFactors.includes('physicalInactivity') || userProfile.bmi >= 25) {
                        type2Indicators += 1;
                    }
                    
                    // If there are more Type 1 indicators, suggest Type 1
                    if (type1Indicators > type2Indicators) {
                        result.message = '<h3>Posibleng Type 1 Diabetes</h3>';
                        result.message += '<p>Base sa iyong mga glucose readings at iba pang factors, ang iyong mga antas ng asukal sa dugo ay mataas at may malaking pagkakaiba-iba, ' +
                                         'na maaaring nagpapahiwatig ng Type 1 diabetes.</p>';
                        result.class = 'type1';
                        result.info = demographicSummary;
                        result.info += '<p>Ang Type 1 diabetes ay isang autoimmune condition kung saan ang katawan ay hindi gumagawa ng insulin. ' +
                                     'Ito ay karaniwang nagsisimula sa kamusmusan o sa pagkabata, pero maaari ring mangyari sa anumang edad.</p>' +
                                     '<p>Ang mga features na nagmumungkahi ng Type 1 diabetes ay: mabilis na pag-onset ng mga sintomas, ' +
                                     'malaking pagkakaiba-iba sa mga glucose levels, at mataas na mga spike sa glucose.</p>' +
                                     '<p><strong>Medikal na Atensyon:</strong> Kung pinaghihinalaan ang Type 1 diabetes, ' +
                                     'kinakailangan ang agarang medikal na atensyon dahil maaaring magdulot ito ng mga seryosong komplikasyon kung hindi gamutin.</p>';
                    } 
                    // Otherwise, suggest Type 2
                    else {
                        result.message = '<h3>Posibleng Type 2 Diabetes</h3>';
                        result.message += '<p>Base sa iyong mga glucose readings at risk factors, ang iyong mga antas ng asukal sa dugo at profile ay nagpapahiwatig ng posibleng Type 2 diabetes.</p>';
                        result.class = 'type2';
                        result.info = demographicSummary;
                        result.info += '<p>Ang Type 2 diabetes ay isang chronic condition na nakakaapekto sa paraan ng pag-process ng katawan ng asukal sa dugo. ' +
                                     'Sa Type 2 diabetes, ang katawan ay either lumalaban sa epekto ng insulin o hindi gumagawa ng sapat na insulin upang ' +
                                     'mapanatili ang normal na mga antas ng glucose.</p>' +
                                     '<p>Ang Type 2 diabetes ay karaniwang nagde-develop sa paglipas ng panahon at kadalasang nauugnay sa ' +
                                     'pagkakaroon ng sobrang timbang, kakulangan ng physical activity, at genetic factors.</p>' +
                                     '<p>Ang management ng Type 2 diabetes ay maaaring kasangkutan ng healthy diet, regular na exercise, pagbabawas ng timbang, ' +
                                     'monitoring ng blood glucose, at sa ilang mga kaso, oral medications o insulin therapy.</p>';
                    }
                    
                    result.info += '<p><strong>Mahalagang Paalala:</strong> Ang diabetes ay isang seryosong medikal na kondisyon na nangangailangan ng propesyonal na ' +
                                  'diagnosis at management. Ang data analysis na ito ay batay lamang sa iyong mga self-reported glucose readings at risk factors at hindi ' +
                                  'kapalit ng isang propesyonal na medikal na diagnosis. Mangyaring kumonsulta sa healthcare provider para sa ' +
                                  'kumpirmadong diagnosis at personalized na treatment plan.</p>';
                }
                
                // Add statistics
                result.info += '<h3>Buod ng Iyong Glucose Readings:</h3>';
                result.info += '<ul>';
                if (fastingReadings.length > 0) {
                    result.info += `<li>Average fasting glucose: ${averageFasting.toFixed(1)} mg/dL</li>`;
                }
                result.info += `<li>Average overall glucose: ${averageOverall.toFixed(1)} mg/dL</li>`;
                result.info += `<li>Kabuuang bilang ng mga reading: ${readings.length}</li>`;
                result.info += `<li>Diabetes Risk Score: ${diabetesRiskScore}/10</li>`;
                result.info += '</ul>';
                
                // Add general disclaimer
                result.info += '<p><strong>Disclaimer:</strong> Ang tool na ito ay para sa educational purposes lamang at hindi kapalit ng propesyonal na medikal na payo. ' +
                              'Palaging kumunsulta sa isang healthcare professional para sa tamang diagnosis at paggamot.</p>';
                
                return result;
            }
            
            function calculateDiabetesRiskScore(userProfile, riskFactors) {
                let score = 0;
                
                // Age-related risk
                if (userProfile.age >= 65) {
                    score += 3;
                } else if (userProfile.age >= 45) {
                    score += 2;
                } else if (userProfile.age >= 25) {
                    score += 1;
                }
                
                // BMI-related risk
                if (userProfile.bmi >= 30) {
                    score += 3;
                } else if (userProfile.bmi >= 25) {
                    score += 2;
                }
                
                // Risk factors contribution
                const majorRiskFactors = ['familyHistory', 'hypertension', 'prediabetesHistory', 'gestational'];
                const moderateRiskFactors = ['physicalInactivity', 'ethnicRisk', 'pcos', 'cholesterol', 'heartDisease', 'sleep'];
                
                // Count major risk factors (more weight)
                majorRiskFactors.forEach(factor => {
                    if (riskFactors.includes(factor)) {
                        score += 2;
                    }
                });
                
                // Count moderate risk factors
                moderateRiskFactors.forEach(factor => {
                    if (riskFactors.includes(factor)) {
                        score += 1;
                    }
                });
                
                // Cap the score at 10
                return Math.min(score, 10);
            }
            
            function calculateStandardDeviation(values) {
                if (values.length === 0) return 0;
                
                const avg = values.reduce((sum, val) => sum + val, 0) / values.length;
                const squareDiffs = values.map(value => {
                    const diff = value - avg;
                    return diff * diff;
                });
                const avgSquareDiff = squareDiffs.reduce((sum, val) => sum + val, 0) / squareDiffs.length;
                return Math.sqrt(avgSquareDiff);
            }
        });
    </script>
</body>
</html>
